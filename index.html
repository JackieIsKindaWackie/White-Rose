<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cayden Collins — Music Portfolio</title>
  <meta name="description" content="Interactive music portfolio for Cayden Collins (White Rose Arts)." />
  <meta property="og:title" content="Cayden Collins — Music Portfolio" />
  <meta property="og:description" content="Listen, read program notes, and explore an interactive timeline." />
  <meta property="og:type" content="website" />
  <style>
    /* ——— CSS RESET (lite) ——— */
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0}
    img{max-width:100%;display:block}
    button{font:inherit}

    /* ——— THEME ——— */
    :root{
      --bg:#0b0b0c;         /* near-black */
      --bg-soft:#111216;    /* cards */
      --text:#e9eaec;       /* primary text */
      --muted:#a7adba;      /* secondary */
      --accent:#b3f5ff;     /* ice blue */
      --accent-2:#ffd6f1;   /* rosy highlight */
      --ink:#1c1d22;        /* strokes */
      --rose:#ffffff;       /* white rose */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    [data-theme="light"]{
      --bg:#ffffff;
      --bg-soft:#f2f5f8;
      --text:#101316;
      --muted:#4d5562;
      --accent:#0ea5e9;
      --accent-2:#c026d3;
      --ink:#d9dee5;
      --rose:#111316;
    }
    body{background:radial-gradient(1200px 600px at 85% -10%,rgba(179,245,255,.08),transparent),
          radial-gradient(900px 500px at -10% 20%,rgba(255,214,241,.08),transparent),
          var(--bg);
      color:var(--text);font:500 16px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;}

    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}

    .container{width:min(1100px,92vw);margin-inline:auto}

    /* ——— NAV ——— */
    header{position:sticky;top:0;z-index:40;background:linear-gradient(to bottom,rgba(0,0,0,.45),transparent),var(--bg);backdrop-filter: blur(10px)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;align-items:center;gap:12px}
    .brand svg{width:28px;height:28px}
    .brand h1{font-size:18px;margin:0;letter-spacing:.4px}
    .nav a.link{color:var(--text);opacity:.8;margin-left:18px}
    .nav a.link:hover{opacity:1}
    .ghost{background:transparent;border:1px solid var(--ink);color:var(--text);padding:8px 12px;border-radius:999px}
    .ghost:hover{border-color:var(--accent);color:var(--accent)}

    /* ——— HERO ——— */
    .hero{padding:56px 0 18px;display:grid;grid-template-columns:1.2fr .8fr;gap:28px;align-items:center}
    @media (max-width: 900px){.hero{grid-template-columns:1fr;padding-top:28px}}
    .title{font-size:clamp(28px,3.5vw,44px);line-height:1.1;margin:0 0 12px;font-weight:800}
    .subtitle{color:var(--muted);margin:0 0 14px}
    .heroCard{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,0));padding:20px;border:1px solid var(--ink);border-radius:var(--radius);box-shadow:var(--shadow)}
    .pills{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .pill{border:1px solid var(--ink);padding:6px 10px;border-radius:999px;color:var(--muted);font-size:12px}

    .canvasWrap{position:relative;border-radius:var(--radius);overflow:hidden;border:1px solid var(--ink);background:var(--bg-soft)}
    .vizCanvas{display:block;width:100%;aspect-ratio:16/10;background:linear-gradient(180deg,rgba(255,255,255,.02),transparent)}
    .canvasOverlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;mix-blend:screen}
    .roseMark{opacity:.25}

    /* ——— SECTION ——— */
    section{padding:34px 0}
    .sectionHead{display:flex;align-items:end;justify-content:space-between;margin-bottom:14px}
    .sectionHead h2{margin:0;font-size:20px}
    .muted{color:var(--muted);font-size:14px}

    /* ——— GRID OF WORKS ——— */
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{grid-column: span 4;background:var(--bg-soft);border:1px solid var(--ink);border-radius:16px;overflow:hidden;display:flex;flex-direction:column;transition: transform .2s ease, border-color .2s}
    .card:hover{transform: translateY(-2px);border-color:var(--accent)}
    .cover{aspect-ratio:16/10;background:linear-gradient(120deg,rgba(179,245,255,.2),rgba(255,214,241,.2));display:grid;place-items:center}
    .cardBody{padding:14px}
    .card h3{margin:0 0 6px;font-size:16px}
    .meta{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:12px}
    .tags{display:flex;gap:6px;flex-wrap:wrap;margin-top:10px}
    .tag{border:1px solid var(--ink);padding:4px 8px;border-radius:999px;font-size:11px;color:var(--muted)}
    .row{display:flex;gap:8px;margin-top:12px}
    .btn{padding:9px 12px;border-radius:12px;border:1px solid var(--ink);background:transparent;color:var(--text);cursor:pointer}
    .btn:hover{border-color:var(--accent);color:var(--accent)}
    .btn.primary{background:linear-gradient(180deg,rgba(179,245,255,.12),rgba(179,245,255,.02));border-color:rgba(179,245,255,.35)}
    @media (max-width: 1000px){.card{grid-column: span 6}}
    @media (max-width: 680px){.card{grid-column: span 12}}

    /* ——— TIMELINE ——— */
    .timeline{border-left:2px dashed var(--ink);padding-left:20px;margin-left:8px}
    .tlItem{margin:14px 0;position:relative}
    .dot{position:absolute;left:-31px;top:2px;width:12px;height:12px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 4px rgba(14,165,233,.18)}
    .tlItem a{display:inline-flex;gap:8px;align-items:center}

    /* ——— ABOUT & CONTACT ——— */
    .about{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    @media (max-width:900px){.about{grid-template-columns:1fr}}

    /* ——— MODAL ——— */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:22px;z-index:60}
    .modal[open]{display:flex}
    .modalCard{width:min(820px,100%);background:var(--bg);border:1px solid var(--ink);border-radius:18px;overflow:hidden;box-shadow:var(--shadow)}
    .modalHead{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--ink)}
    .modalBody{display:grid;grid-template-columns:1fr 1fr;gap:14px;padding:14px}
    @media (max-width:800px){.modalBody{grid-template-columns:1fr}}
    .close{border:none;background:transparent;color:var(--muted);cursor:pointer;font-size:22px}
    .noteBox{border:1px dashed var(--ink);border-radius:14px;padding:12px;color:var(--muted);max-height:280px;overflow:auto}
    .extLinks a{margin-right:10px}

    /* ——— STICKY PLAYER ——— */
    .player{position:sticky;bottom:16px;z-index:50}
    .playerCard{margin:0 auto;width:min(900px,94vw);display:flex;align-items:center;gap:12px;background:var(--bg);border:1px solid var(--ink);border-radius:16px;padding:10px 12px;box-shadow:var(--shadow)}
    .miniCover{width:44px;height:44px;border-radius:10px;background:linear-gradient(120deg,rgba(179,245,255,.2),rgba(255,214,241,.2))}
    .grow{flex:1}
    .range{appearance:none;width:100%}
    .range::-webkit-slider-thumb{appearance:none;width:14px;height:14px;border-radius:50%;background:var(--accent);border:none}
    .range::-webkit-slider-runnable-track{height:6px;background:linear-gradient(90deg,var(--accent) var(--pct,0%),rgba(255,255,255,.18) 0)}
    .iconBtn{border:1px solid var(--ink);background:transparent;border-radius:10px;padding:8px;cursor:pointer}

    footer{padding:36px 0;color:var(--muted)}

    /* ——— ANIMATIONS ——— */
    .reveal{opacity:0;transform:translateY(10px);transition:.5s ease}
    .reveal.in{opacity:1;transform:none}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand" aria-label="White Rose Arts">
        <!-- Minimal white rose glyph -->
        <svg class="roseMark" viewBox="0 0 64 64" fill="none" aria-hidden="true">
          <circle cx="32" cy="32" r="28" stroke="var(--rose)" opacity=".35"/>
          <path d="M32 16c6 0 12 5 12 11 0 9-9 13-12 21-3-8-12-12-12-21 0-6 6-11 12-11Z" stroke="var(--rose)"/>
          <path d="M27 24c2-2 7-2 9 0" stroke="var(--rose)" opacity=".6"/>
        </svg>
        <h1>White Rose Arts · Music</h1>
      </div>
      <div>
        <a class="link" href="#works">Works</a>
        <a class="link" href="#timeline">Timeline</a>
        <a class="link" href="#about">About</a>
        <a class="link" href="#contact">Contact</a>
        <button id="themeBtn" class="ghost" aria-label="Toggle theme">Toggle theme</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- HERO ---------------------------------------------------------- -->
    <section class="hero">
      <div class="heroCard reveal">
        <h2 class="title">Cayden Collins</h2>
        <p class="subtitle">Composer • Piano • Sound Design · <span style="color:var(--accent)">White Rose Arts</span></p>
        <p style="margin:0">Listen to selected works, read concise program notes, and explore an interactive timeline. Designed to load fast, look clean, and work anywhere (desktop to phone). Edit a simple JSON in the code to update everything.</p>
        <div class="pills">
          <span class="pill">Interactive visualizer</span>
          <span class="pill">Sticky mini‑player</span>
          <span class="pill">Program notes</span>
          <span class="pill">Shareable links</span>
          <span class="pill">Light/Dark</span>
          <span class="pill">Keyboard: ␣ ⬅ ➡</span>
        </div>
      </div>
      <div class="canvasWrap reveal">
        <canvas id="viz" class="vizCanvas" aria-hidden="true"></canvas>
        <div class="canvasOverlay">
          <svg class="roseMark" viewBox="0 0 64 64" width="120" height="120" fill="none" aria-hidden="true">
            <circle cx="32" cy="32" r="28" stroke="var(--rose)" opacity=".25"/>
            <path d="M32 16c6 0 12 5 12 11 0 9-9 13-12 21-3-8-12-12-12-21 0-6 6-11 12-11Z" stroke="var(--rose)"/>
          </svg>
        </div>
      </div>
    </section>

    <!-- WORKS --------------------------------------------------------- -->
    <section id="works">
      <div class="sectionHead">
        <h2>Selected Works</h2>
        <p class="muted">Click Play for the mini‑player · Details opens notes and embeds</p>
      </div>
      <div id="grid" class="grid"></div>
    </section>

    <!-- TIMELINE ------------------------------------------------------ -->
    <section id="timeline">
      <div class="sectionHead">
        <h2>Timeline</h2>
        <p class="muted">A quick view of releases and premieres</p>
      </div>
      <div id="tl" class="timeline"></div>
    </section>

    <!-- ABOUT --------------------------------------------------------- -->
    <section id="about" class="about">
      <div class="heroCard reveal">
        <h2 style="margin-top:0">About</h2>
        <p>I'm Cayden, a multidisciplinary musician and designer based in South Carolina, building <em>White Rose Arts</em>. I compose for indoor percussion, piano, and hybrid electronic projects. I care about clarity, tension, and emotional release.</p>
        <p class="muted">This site is a single HTML file: free to host on GitHub Pages/Netlify. Edit the <code>TRACKS</code> array to update content.</p>
      </div>
      <div class="heroCard reveal">
        <h2 style="margin-top:0">How to update</h2>
        <ol style="margin:0 0 8px 18px">
          <li>Open this file and find <code>const TRACKS = [...]</code>.</li>
          <li>Replace placeholders with your titles, years, tags, notes, and links.<br><span class="muted">Use <code>mp3</code> for direct audio or add a <code>soundcloud</code>/<code>youtube</code> link to embed.</span></li>
          <li>Save as <strong>index.html</strong> and upload to GitHub Pages or Netlify.</li>
        </ol>
        <p class="muted" style="margin:0">Tip: Put cover images (1200×750) in an <code>assets/</code> folder and reference their paths.</p>
      </div>
    </section>

    <!-- CONTACT ------------------------------------------------------- -->
    <section id="contact">
      <div class="sectionHead"><h2>Contact</h2><span></span></div>
      <div class="heroCard reveal">
        <p>Commissions, licensing, or design collabs:</p>
        <p><a href="mailto:whiterosearts.contact@gmail.com">whiterosearts.contact@gmail.com</a> • Instagram: <a href="https://instagram.com/" target="_blank" rel="noopener">@whiterose.arts</a></p>
      </div>
    </section>

    <!-- STICKY PLAYER ------------------------------------------------- -->
    <div class="player" aria-live="polite">
      <div class="playerCard">
        <div class="miniCover" id="miniCover" aria-hidden="true"></div>
        <div class="grow">
          <div style="display:flex;align-items:center;gap:10px;justify-content:space-between">
            <strong id="nowTitle">Select a track</strong>
            <span id="nowTime" class="muted">0:00 / 0:00</span>
          </div>
          <input id="seek" class="range" type="range" min="0" max="100" value="0" aria-label="Seek" />
        </div>
        <button id="prevBtn" class="iconBtn" title="Previous (←)" aria-label="Previous">⟨⟨</button>
        <button id="playBtn" class="iconBtn" title="Play/Pause (Space)" aria-label="Play">▶</button>
        <button id="nextBtn" class="iconBtn" title="Next (→)" aria-label="Next">⟩⟩</button>
        <audio id="audio" preload="none" crossorigin="anonymous"></audio>
      </div>
    </div>
  </main>

  <!-- MODAL: TRACK DETAILS ------------------------------------------- -->
  <dialog id="modal" class="modal" aria-label="Track details">
    <div class="modalCard">
      <div class="modalHead">
        <div>
          <strong id="mTitle">Title</strong>
          <div id="mMeta" class="muted" style="font-size:13px"></div>
        </div>
        <div>
          <button id="shareBtn" class="ghost" style="margin-right:8px">Copy link</button>
          <button id="closeModal" class="close" aria-label="Close">✕</button>
        </div>
      </div>
      <div class="modalBody">
        <div>
          <div id="mMedia" style="border:1px solid var(--ink);border-radius:14px;overflow:hidden;aspect-ratio:16/9;background:var(--bg-soft);"></div>
          <div class="extLinks" id="mLinks" style="margin-top:10px"></div>
        </div>
        <div class="noteBox" id="mNotes"></div>
      </div>
    </div>
  </dialog>

  <footer class="container">
    <p>© <span id="year"></span> White Rose Arts · Built as a single‑file site. Free to host. </p>
  </footer>

  <script>
    // ————————————————————————————————————————————————————————————————
    // 1) CONTENT — Edit this array with your tracks
    //    Fields:
    //    id, title, year, tags[], cover, mp3 (optional), notes (HTML ok),
    //    links: { soundcloud, youtube, score }
    // ————————————————————————————————————————————————————————————————
    const TRACKS = [
      {
        id: 'divine-machinery',
        title: 'Divine Machinery :: Ex Machina',
        year: 2025,
        tags: ['indoor percussion','cinematic','electronic'],
        cover: 'assets/divine-cover.jpg', // replace with your image path
        mp3: 'assets/divine-demo.mp3',     // replace with your mp3 path or omit
        notes: `A meditation on transcendence and synthetic spirituality. Built on pulsing gears and glass‑like harmonies; written for world‑class indoor percussion.`,
        links: { soundcloud: '', youtube: '', score: '' }
      },
      {
        id: 'white-rose-piano',
        title: 'White Rose (Piano Version)',
        year: 2024,
        tags: ['piano','ambient'],
        cover: 'assets/rose-cover.jpg',
        mp3: 'assets/white-rose-piano.mp3',
        notes: `Minimalist piano with slow bloom. Theme of the White Rose Arts identity.`,
        links: { soundcloud: '', youtube: '' }
      },
      {
        id: 'kinetic-study',
        title: 'Kinetic Study No. 1',
        year: 2023,
        tags: ['study','electro‑acoustic'],
        cover: '',
        mp3: '', // leave empty to force embed usage
        notes: `Short exploration in texture. If <code>mp3</code> is empty, add a SoundCloud or YouTube link below to embed.`,
        links: { soundcloud: 'https://soundcloud.com/', youtube: '' }
      }
    ];

    // ————————————————————————————————————————————————————————————————
    // 2) UTIL & STATE
    // ————————————————————————————————————————————————————————————————
    const $ = sel => document.querySelector(sel);
    const grid = $('#grid');
    const tl = $('#tl');
    const audio = $('#audio');
    const playBtn = $('#playBtn');
    const prevBtn = $('#prevBtn');
    const nextBtn = $('#nextBtn');
    const nowTitle = $('#nowTitle');
    const nowTime = $('#nowTime');
    const seek = $('#seek');
    const miniCover = $('#miniCover');
    const modal = $('#modal');
    const mTitle = $('#mTitle');
    const mMeta = $('#mMeta');
    const mMedia = $('#mMedia');
    const mLinks = $('#mLinks');
    const mNotes = $('#mNotes');
    const closeModal = $('#closeModal');
    const shareBtn = $('#shareBtn');
    const themeBtn = $('#themeBtn');

    let index = 0; // current track index
    let ctx, analyser, source, dataArr, raf;

    // Theme
    const storedTheme = localStorage.getItem('theme');
    if(storedTheme){ document.documentElement.setAttribute('data-theme', storedTheme); }
    themeBtn.addEventListener('click', () => {
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur === 'light' ? '' : 'light';
      if(next) document.documentElement.setAttribute('data-theme', next); else document.documentElement.removeAttribute('data-theme');
      localStorage.setItem('theme', next);
    });

    // Build Works Grid
    function buildGrid(){
      grid.innerHTML = '';
      TRACKS.forEach((t, i) => {
        const card = document.createElement('article');
        card.className = 'card reveal';
        card.innerHTML = `
          <div class="cover">${t.cover ? `<img src="${t.cover}" alt="${t.title} cover"/>` : coverSVG()}</div>
          <div class="cardBody">
            <h3>${t.title}</h3>
            <div class="meta"><span>${t.year}</span> · <span>${t.tags?.slice(0,2).join(' / ') || ''}</span></div>
            <div class="tags">${(t.tags||[]).map(tag=>`<span class='tag'>${tag}</span>`).join('')}</div>
            <div class="row">
              <button class="btn primary" data-play="${i}">Play</button>
              <button class="btn" data-details="${i}">Details</button>
            </div>
          </div>`;
        grid.appendChild(card);
      });
    }

    // Build Timeline
    function buildTimeline(){
      const sorted = [...TRACKS].sort((a,b)=>b.year-a.year);
      tl.innerHTML = '';
      sorted.forEach(t => {
        const node = document.createElement('div');
        node.className = 'tlItem reveal';
        node.innerHTML = `<span class='dot' aria-hidden='true'></span>
          <div><strong>${t.year}</strong> — <a href="#" data-focus="${t.id}">${t.title}</a></div>`;
        tl.appendChild(node);
      })
    }

    // Player Controls
    function load(i){
      index = i;
      const t = TRACKS[i];
      nowTitle.textContent = t.title;
      miniCover.style.backgroundImage = t.cover ? `url('${t.cover}')` : '';
      if(t.mp3){
        audio.src = t.mp3; audio.load();
      } else {
        audio.removeAttribute('src');
      }
      // Save
      history.replaceState(null, '', `#${t.id}`);
    }

    function play(){ if(audio.src) { audio.play(); playBtn.textContent = '⏸'; } }
    function pause(){ audio.pause(); playBtn.textContent = '▶'; }

    playBtn.addEventListener('click', ()=>{
      if(!audio.src){ openDetails(index); return; }
      if(audio.paused) play(); else pause();
    });
    prevBtn.addEventListener('click', ()=>{ load((index-1+TRACKS.length)%TRACKS.length); play(); });
    nextBtn.addEventListener('click', ()=>{ load((index+1)%TRACKS.length); play(); });

    // Time & Seek
    audio.addEventListener('timeupdate', ()=>{
      const cur = audio.currentTime || 0, dur = audio.duration || 0;
      const pct = dur? (cur/dur*100):0; seek.value = pct; seek.style.setProperty('--pct', pct+'%');
      nowTime.textContent = format(cur) + ' / ' + (dur? format(dur) : '0:00');
    });
    audio.addEventListener('ended', ()=>{ nextBtn.click(); });
    seek.addEventListener('input', ()=>{
      const dur = audio.duration || 0; if(dur){ audio.currentTime = seek.value/100*dur; }
    });

    // Keyboard shortcuts
    window.addEventListener('keydown', e=>{
      if(['INPUT','TEXTAREA'].includes(document.activeElement.tagName)) return;
      if(e.code==='Space'){ e.preventDefault(); playBtn.click(); }
      if(e.key==='ArrowLeft'){ e.preventDefault(); prevBtn.click(); }
      if(e.key==='ArrowRight'){ e.preventDefault(); nextBtn.click(); }
      if(e.key==='Escape' && modal.open){ modal.close(); }
    });

    // Details Modal
    function openDetails(i){
      const t = TRACKS[i];
      mTitle.textContent = t.title;
      mMeta.textContent = `${t.year} · ${(t.tags||[]).join(' / ')}`;
      mNotes.innerHTML = t.notes || '';
      mLinks.innerHTML = '';
      // Media: prefer mp3; else SoundCloud/YouTube embed
      if(t.mp3){
        mMedia.innerHTML = `<audio controls preload="metadata" style="width:100%;height:100%"></audio>`;
        const a = mMedia.querySelector('audio');
        a.src = t.mp3; a.load();
      } else if(t.links?.soundcloud){
        mMedia.innerHTML = `<iframe allow='autoplay' width='100%' height='100%' scrolling='no' frameborder='no' src='https://w.soundcloud.com/player/?url=${encodeURIComponent(t.links.soundcloud)}&visual=true'></iframe>`;
      } else if(t.links?.youtube){
        const id = ytId(t.links.youtube);
        mMedia.innerHTML = id ? `<iframe width='100%' height='100%' src='https://www.youtube.com/embed/${id}' frameborder='0' allow='accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture' allowfullscreen></iframe>` : `<div style='display:grid;place-items:center;height:100%'>No media</div>`;
      } else {
        mMedia.innerHTML = `<div style='display:grid;place-items:center;height:100%'>Add an mp3 or link to SoundCloud/YouTube</div>`;
      }
      // External links
      if(t.links?.soundcloud) addLink('SoundCloud', t.links.soundcloud);
      if(t.links?.youtube) addLink('YouTube', t.links.youtube);
      if(t.links?.score) addLink('Score (PDF)', t.links.score);
      modal.showModal();
      // focus management
      setTimeout(()=>$('#closeModal')?.focus(), 10);
    }
    function addLink(label, href){
      const a = document.createElement('a'); a.textContent = label; a.href = href; a.target = '_blank'; a.rel = 'noopener';
      mLinks.appendChild(a);
    }
    function ytId(url){
      const m = url.match(/[?&]v=([^&#]+)|youtu\.be\/([^?&#]+)/); return m? (m[1]||m[2]) : null;
    }
    closeModal.addEventListener('click', ()=> modal.close());
    shareBtn.addEventListener('click', async ()=>{
      const t = TRACKS[index];
      const url = new URL(location.href); url.hash = t.id;
      try{ await navigator.clipboard.writeText(url.toString()); shareBtn.textContent = 'Copied!'; setTimeout(()=>shareBtn.textContent='Copy link', 1500);}catch{ alert(url.toString()); }
    });

    // Click handlers (delegation)
    grid.addEventListener('click', e=>{
      const p = e.target.closest('[data-play]');
      if(p){ load(+p.dataset.play); play(); }
      const d = e.target.closest('[data-details]');
      if(d){ const i = +d.dataset.details; index = i; openDetails(i); }
    });
    tl.addEventListener('click', e=>{
      const a = e.target.closest('[data-focus]'); if(!a) return; e.preventDefault();
      const id = a.dataset.focus; const i = TRACKS.findIndex(t=>t.id===id); if(i>=0){
        // scroll that card into view
        const card = grid.children[i]; card?.scrollIntoView({behavior:'smooth', block:'center'});
        card?.classList.add('highlight'); setTimeout(()=>card?.classList.remove('highlight'), 800);
      }
    })

    // Visualizer (Web Audio API) — bind to sticky player audio
    function setupAudioViz(){
      try{
        const AudioCtx = window.AudioContext || window.webkitAudioContext; ctx = new AudioCtx();
        analyser = ctx.createAnalyser(); analyser.fftSize = 256;
        dataArr = new Uint8Array(analyser.frequencyBinCount);
        source = ctx.createMediaElementSource(audio); source.connect(analyser); analyser.connect(ctx.destination);
        loopViz();
      }catch(err){ console.warn('AudioContext unavailable', err); }
    }
    function loopViz(){
      const c = document.getElementById('viz'); const x = c.getContext('2d');
      const DPR = Math.min(devicePixelRatio || 1, 2);
      const W = c.clientWidth*DPR, H = c.clientHeight*DPR; if(c.width!==W||c.height!==H){ c.width=W; c.height=H; }
      const draw = ()=>{
        x.clearRect(0,0,W,H);
        if(analyser){ analyser.getByteFrequencyData(dataArr);
          const n = dataArr.length; const barW = W/n; const base = H*0.82;
          for(let i=0;i<n;i++){
            const v = dataArr[i]/255; const h = Math.pow(v,1.7)*H*0.6;
            const cx = i*barW + barW*.3; const cy = base-h;
            // gradient-ish bars
            x.fillStyle = `rgba(179,245,255,${0.25+v*0.6})`;
            x.fillRect(cx, cy, barW*.5, h);
          }
          // horizon line
          x.fillStyle = 'rgba(255,255,255,.06)';
          x.fillRect(0, base, W, 2);
        }
        raf = requestAnimationFrame(draw);
      };
      draw();
    }

    // Helpers
    function format(s){ s = Math.floor(s); const m = Math.floor(s/60), r = s%60; return m+":"+(r<10?"0":"")+r }
    function coverSVG(){
      return `<svg viewBox='0 0 400 250' width='100%' height='100%'>
        <defs>
          <linearGradient id='g' x1='0' x2='1'>
            <stop offset='0%' stop-color='rgba(179,245,255,.25)'/>
            <stop offset='100%' stop-color='rgba(255,214,241,.25)'/>
          </linearGradient>
        </defs>
        <rect width='100%' height='100%' fill='url(#g)'/>
        <g stroke='white' stroke-opacity='.55' fill='none' transform='translate(200,125)'>
          <circle r='80'/>
          <path d='M0-55c22 0 44 18 44 40 0 32-33 45-44 72-11-27-44-40-44-72 0-22 22-40 44-40Z'/>
        </g>
      </svg>`;
    }

    // Reveal on scroll
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('in'); });
    }, {threshold:.08});

    // Init
    function init(){
      document.getElementById('year').textContent = new Date().getFullYear();
      buildGrid(); buildTimeline();
      document.querySelectorAll('.reveal').forEach(el=>io.observe(el));
      setupAudioViz();

      // Deep-link to a track via #id
      const hash = location.hash.replace('#','');
      const idx = TRACKS.findIndex(t=>t.id===hash);
      if(idx>=0){ index = idx; openDetails(index); }
    }

    init();
  </script>
</body>
</html>
